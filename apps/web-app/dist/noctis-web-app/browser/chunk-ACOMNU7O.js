import{a as $}from"./chunk-NI2MUIMM.js";import{a as k}from"./chunk-RGYE5VVO.js";import{a as j,b as W}from"./chunk-IDKFOCDJ.js";import{a as L,b as w}from"./chunk-OLQLXGD7.js";import{c as A,e as U,f as S}from"./chunk-R6BJDFJL.js";import{Fa as f,Ga as x,I as V,Ia as R,Ja as F,Ka as u,La as i,M as v,Ma as n,Na as C,R as E,Ra as M,S as I,Ta as g,Va as d,ba as p,c as b,db as a,eb as D,fb as y,lb as c,o as N,oa as o,ya as _}from"./chunk-VHPO65OP.js";var P=(()=>{class t{api=v($);devices=p([]);status=p("loading");errorMessage=p(null);isFetching=p(!1);claimStatus=p("idle");claimErrorMessage=p(null);primaryDevice=c(()=>this.devices()[0]??null);secondaryDevice=c(()=>this.devices()[1]??null);loadDevices(){return b(this,null,function*(){this.status.set("loading"),this.errorMessage.set(null),this.isFetching.set(!0);try{let e=yield N(this.api.getDevices());this.devices.set(e),this.status.set(e.length>0?"success":"no-data")}catch(e){let r=L(e);this.errorMessage.set(r.message),this.status.set("error")}finally{this.isFetching.set(!1)}})}claimDeviceByExternalId(e){return b(this,null,function*(){let r=e.trim();if(!r){this.claimStatus.set("error"),this.claimErrorMessage.set("Device external ID is required.");return}this.claimStatus.set("pending"),this.claimErrorMessage.set(null);try{let s=yield N(this.api.claimDeviceById({deviceExternalId:r}));this.devices.update(l=>{let h=l.findIndex(B=>B.id===s.id);return h>=0?l.map((B,K)=>K===h?s:B):[s,...l]}),this.status.set("success"),this.claimStatus.set("success")}catch(s){let l=L(s);this.claimErrorMessage.set(l.message),this.claimStatus.set("error")}})}resetClaimState(){this.claimStatus.set("idle"),this.claimErrorMessage.set(null)}static \u0275fac=function(r){return new(r||t)};static \u0275prov=V({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var z=(t,m)=>m.id;function G(t,m){t&1&&(i(0,"div",1),C(1,"ui-skeleton",5)(2,"ui-skeleton",5),n()),t&2&&(o(),u("height",24),o(),u("height",160))}function J(t,m){if(t&1){let e=M();i(0,"app-state-panel",6),g("action",function(){E(e);let s=d();return I(s.reload())}),n()}}function Q(t,m){if(t&1){let e=M();i(0,"app-state-panel",7),g("action",function(){E(e);let s=d();return I(s.reload())}),n()}}function X(t,m){if(t&1){let e=M();i(0,"app-state-panel",8),g("action",function(){E(e);let s=d();return I(s.reload())}),n()}if(t&2){let e=d();u("message",e.store.errorMessage()??"Check Bluetooth or Wi\u2011Fi, then retry.")}}function Y(t,m){if(t&1&&(i(0,"div",14)(1,"div")(2,"strong"),a(3),n(),i(4,"div",21),a(5),n()(),i(6,"span",21),a(7),n()()),t&2){let e=m.$implicit;o(3),D(e.name),o(2),y(" ",e.external_id?"External ID "+e.external_id:"No external ID"," "),o(2),y(" ",e.user_id?"Linked":"Unlinked"," ")}}function Z(t,m){if(t&1){let e=M();i(0,"div",9)(1,"div")(2,"p",10),a(3,"Device Sync"),n(),i(4,"h1",11),a(5),n()(),i(6,"a",12),a(7,"Dashboard"),n()(),i(8,"div",1),C(9,"ui-status-banner",13),R(10,Y,8,3,"div",14,z),i(12,"div",15)(13,"p",16),a(14),n(),i(15,"p",16),a(16),n()(),i(17,"div",17)(18,"ui-button",18),g("click",function(){E(e);let s=d();return I(s.reload())}),a(19,"Refresh devices"),n(),i(20,"a",19),a(21," Claim by external ID "),n(),i(22,"a",20),a(23," Bluetooth / Wi\u2011Fi help "),n()()()}if(t&2){let e=d();o(5),D(e.primaryDeviceName()),o(4),u("title",e.syncBannerTitle())("message",e.syncBannerMessage()),o(),F(e.devices()),o(4),y(" ",e.syncBannerMessage()," "),o(2),D(e.deviceCountLabel())}}var O=(()=>{class t{store=v(P);viewState=this.store.status;devices=this.store.devices;primaryDeviceName=c(()=>this.store.primaryDevice()?.name??"Sleep Band");deviceCountLabel=c(()=>{let e=this.devices().length;return`${e} device${e===1?"":"s"} registered`});syncBannerTitle=c(()=>this.store.isFetching()?"Refreshing devices":"Device registry up to date");syncBannerMessage=c(()=>{let e=this.store.primaryDevice();return e?`Primary device: ${e.name}`:"No device connected yet."});ngOnInit(){this.store.loadDevices()}reload(){this.store.loadDevices()}static \u0275fac=function(r){return new(r||t)};static \u0275cmp=_({type:t,selectors:[["app-device-page"]],decls:6,vars:1,consts:[[1,"screen","screen--dark","sleep-summary-theme"],[1,"screen__section"],["title","No device connected","message","Add a device to sync sleep data.","actionLabel","Add device"],["title","Syncing device","message","Keep the app open while we sync.","actionLabel","View progress"],["title","Couldn't connect","actionLabel","Retry",3,"message"],[3,"height"],["title","No device connected","message","Add a device to sync sleep data.","actionLabel","Add device",3,"action"],["title","Syncing device","message","Keep the app open while we sync.","actionLabel","View progress",3,"action"],["title","Couldn't connect","actionLabel","Retry",3,"action","message"],[1,"screen__header"],[1,"screen__sub"],[1,"screen__title"],["routerLink","/dashboard",1,"primary-link"],["variant","ok",3,"title","message"],[1,"list-row"],[1,"chart-card"],[1,"chart-card__summary"],[1,"screen__cta"],[3,"click"],["routerLink","/device/claim",1,"primary-link"],["routerLink","/device/help",1,"primary-link"],[1,"list-row__meta"]],template:function(r,s){if(r&1&&(i(0,"section",0),f(1,G,3,2,"div",1)(2,J,1,0,"app-state-panel",2)(3,Q,1,0,"app-state-panel",3)(4,X,1,1,"app-state-panel",4)(5,Z,24,5),n()),r&2){let l;o(),x((l=s.viewState())==="loading"?1:l==="no-data"?2:l==="syncing"?3:l==="error"?4:5)}},dependencies:[S,w,j,k,W],encapsulation:2})}return t})();function ee(t,m){t&1&&C(0,"ui-status-banner",6)}function te(t,m){if(t&1&&C(0,"ui-status-banner",7),t&2){let e=d();u("message",e.successMessage())}}function ie(t,m){if(t&1&&(i(0,"p",13),a(1),n()),t&2){let e=d();o(),D(e.store.claimErrorMessage())}}var q=(()=>{class t{store=v(P);router=v(U);route=v(A);externalIdInput=p("");isPending=c(()=>this.store.claimStatus()==="pending");showPendingBanner=c(()=>this.store.claimStatus()==="pending");showSuccessBanner=c(()=>this.store.claimStatus()==="success");submitLabel=c(()=>this.isPending()?"Claiming...":"Claim device");canSubmit=c(()=>this.externalIdInput().trim().length>0);successMessage=c(()=>`Linked ${this.externalIdInput().trim()} to this account.`);ngOnInit(){this.store.resetClaimState()}onExternalIdInput(e){let r=e.target;this.externalIdInput.set(r.value),this.store.claimStatus()!=="idle"&&this.store.resetClaimState()}onSubmit(e){return b(this,null,function*(){if(e.preventDefault(),!this.canSubmit()||this.isPending()||(yield this.store.claimDeviceByExternalId(this.externalIdInput()),this.store.claimStatus()!=="success"))return;let r=this.route.snapshot.queryParamMap.get("redirect"),s=r&&r.startsWith("/")&&!r.startsWith("//")?r:"/dashboard";yield this.router.navigateByUrl(s)})}static \u0275fac=function(r){return new(r||t)};static \u0275cmp=_({type:t,selectors:[["app-device-claim-page"]],decls:25,vars:6,consts:[[1,"screen","screen--dark","sleep-summary-theme"],[1,"screen__header"],[1,"screen__sub"],[1,"screen__title"],["routerLink","/device",1,"primary-link"],[1,"screen__section",3,"submit"],["variant","syncing","title","Claim in progress","message","We are linking this device to your account."],["variant","ok","title","Device claimed",3,"message"],["for","device-external-id",1,"form-field"],[1,"form-field__label"],["id","device-external-id","type","text","autocomplete","off","maxlength","200","placeholder","e.g. dodh-lite-001","required","",1,"form-field__input",3,"input","value"],[1,"chart-card"],[1,"chart-card__summary"],["role","alert",1,"form-error"],[1,"screen__cta"],["type","submit",3,"disabled"],["routerLink","/device/help",1,"primary-link"]],template:function(r,s){r&1&&(i(0,"section",0)(1,"div",1)(2,"div")(3,"p",2),a(4,"Device setup"),n(),i(5,"h1",3),a(6,"Claim by external ID"),n()(),i(7,"a",4),a(8,"Back"),n()(),i(9,"form",5),g("submit",function(h){return s.onSubmit(h)}),f(10,ee,1,0,"ui-status-banner",6),f(11,te,1,1,"ui-status-banner",7),i(12,"label",8)(13,"span",9),a(14,"Device external ID"),n(),i(15,"input",10),g("input",function(h){return s.onExternalIdInput(h)}),n()(),i(16,"div",11)(17,"p",12),a(18," Enter the external ID printed in app pairing or device settings. "),n()(),f(19,ie,2,1,"p",13),i(20,"div",14)(21,"ui-button",15),a(22),n(),i(23,"a",16),a(24,"Need help finding the ID?"),n()()()()),r&2&&(o(10),x(s.showPendingBanner()?10:-1),o(),x(s.showSuccessBanner()?11:-1),o(4),u("value",s.externalIdInput()),o(4),x(s.store.claimErrorMessage()?19:-1),o(2),u("disabled",!s.canSubmit()||s.isPending()),o(),y(" ",s.submitLabel()," "))},dependencies:[S,k,w],encapsulation:2})}return t})();var H=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275cmp=_({type:t,selectors:[["app-device-help-page"]],decls:29,vars:0,consts:[[1,"screen","screen--dark","sleep-summary-theme"],[1,"screen__header"],[1,"screen__sub"],[1,"screen__title"],["routerLink","/device",1,"primary-link"],[1,"screen__section"],["aria-labelledby","device-help-checklist-title",1,"state-panel"],["id","device-help-checklist-title"],[1,"help-list"],["aria-labelledby","device-help-support-title",1,"state-panel"],["id","device-help-support-title"]],template:function(r,s){r&1&&(i(0,"section",0)(1,"div",1)(2,"div")(3,"p",2),a(4,"Connection help"),n(),i(5,"h1",3),a(6,"Troubleshooting"),n()(),i(7,"a",4),a(8,"Back"),n()(),i(9,"div",5)(10,"article",6)(11,"h3",7),a(12,"Before retrying sync"),n(),i(13,"ol",8)(14,"li"),a(15,"Keep your phone within 2 meters of the sleep device."),n(),i(16,"li"),a(17,"Confirm Bluetooth is on and Airplane Mode is off."),n(),i(18,"li"),a(19,"Charge the device for at least 10 minutes if LED is red."),n(),i(20,"li"),a(21,"Reopen the app, then use Refresh Devices on the device screen."),n()()(),i(22,"article",9)(23,"h3",10),a(24,"If issues continue"),n(),i(25,"p"),a(26," Remove the device in system Bluetooth settings, pair again, then run a new sync. "),n(),i(27,"a",4),a(28,"Return to device sync"),n()()()())},dependencies:[S],styles:[".help-list[_ngcontent-%COMP%]{margin:0;padding-left:1.1rem;display:grid;gap:.45rem;color:var(--text-1)}"]})}return t})();var Ne=[{path:"",component:O},{path:"help",component:H},{path:"claim",component:q}];export{Ne as DEVICE_ROUTES};
