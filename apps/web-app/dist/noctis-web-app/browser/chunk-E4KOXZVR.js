import{a as k,b as D}from"./chunk-IDKFOCDJ.js";import{a as F,b as P}from"./chunk-OLQLXGD7.js";import{f as V}from"./chunk-R6BJDFJL.js";import{Cb as A,Fa as b,Ga as R,Ha as U,I as y,Ia as M,Ja as T,Ka as d,La as n,M as v,Ma as o,Na as I,R as m,Ra as x,S as c,Ta as _,Va as u,a as j,ba as g,c as C,db as l,eb as h,fb as E,lb as f,o as L,oa as s,ya as w}from"./chunk-VHPO65OP.js";var B=(()=>{class i{api=v(A);getRoutine(){return this.api.get("/v1/routines/current")}updateRoutine(e){return this.api.put("/v1/routines/current",{title:e.title,steps:e.steps?.map(t=>({id:t.id,title:t.title,duration_minutes:t.durationMinutes,emoji:t.emoji??null}))})}static \u0275fac=function(t){return new(t||i)};static \u0275prov=y({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var N=(()=>{class i{api=v(B);routine=g(null);status=g("loading");errorMessage=g(null);isFetching=g(!1);isSaving=g(!1);loadRoutine(){return C(this,null,function*(){this.status.set("loading"),this.errorMessage.set(null),this.isFetching.set(!0);try{let e=yield L(this.api.getRoutine());this.routine.set(e),this.status.set(e.steps.length>0?"success":"no-data")}catch(e){let t=F(e);this.errorMessage.set(t.message),this.status.set("error")}finally{this.isFetching.set(!1)}})}updateRoutine(e){return C(this,null,function*(){if(this.routine()){this.isSaving.set(!0),this.errorMessage.set(null),this.status.set("syncing");try{let t=yield L(this.api.updateRoutine(e));this.routine.set(t),this.status.set(t.steps.length>0?"success":"no-data")}catch(t){let r=F(t);this.errorMessage.set(r.message),this.status.set("error")}finally{this.isSaving.set(!1)}}})}static \u0275fac=function(t){return new(t||i)};static \u0275prov=y({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var W=(i,p)=>p.id;function z(i,p){i&1&&(n(0,"div",1),I(1,"ui-skeleton",5)(2,"ui-skeleton",5),o()),i&2&&(s(),d("height",26),s(),d("height",160))}function G(i,p){if(i&1){let e=x();n(0,"app-state-panel",6),_("action",function(){m(e);let r=u();return c(r.reload())}),o()}}function H(i,p){if(i&1){let e=x();n(0,"app-state-panel",7),_("action",function(){m(e);let r=u();return c(r.reload())}),o()}}function J(i,p){if(i&1){let e=x();n(0,"app-state-panel",8),_("action",function(){m(e);let r=u();return c(r.reload())}),o()}if(i&2){let e=u();d("message",e.store.errorMessage()??"We could not load your routine.")}}function K(i,p){if(i&1&&(n(0,"div",13)(1,"div")(2,"strong"),l(3),o(),n(4,"div",19),l(5),o()(),n(6,"span"),l(7),o()()),i&2){let e=p.$implicit;s(3),h(e.title),s(2),E(" ",e.duration_minutes," min "),s(2),h(e.emoji||"\u2022")}}function Q(i,p){if(i&1&&(n(0,"div",9)(1,"div")(2,"p",10),l(3,"Bedtime Routine"),o(),n(4,"h1",11),l(5),o(),n(6,"p",10),l(7),o()(),n(8,"a",12),l(9,"Back"),o()(),n(10,"div",1),M(11,K,8,3,"div",13,W),n(13,"div",14)(14,"p",15),l(15),o(),n(16,"a",16),l(17,"Review steps"),o()(),n(18,"div",17)(19,"ui-button"),l(20,"Start Routine"),o(),n(21,"a",18),l(22,"Edit routine"),o()()()),i&2){let e=u();s(5),h(e.routineTitle()),s(2),h(e.routineDurationLabel()),s(4),T(e.routineSteps()),s(4),E(" ",e.suggestionLabel()," ")}}var q=(()=>{class i{store=v(N);viewState=this.store.status;routineTitle=f(()=>this.store.routine()?.title??"Tonight's routine");routineDurationLabel=f(()=>{let e=this.store.routine()?.total_minutes;return e==null?"~12 min total":`~${e} min total`});routineSteps=f(()=>this.store.routine()?.steps??[]);suggestionLabel=f(()=>{let e=this.routineSteps();return e.length===0?"Add your first wind-down step to build consistency.":`Start with ${e[0].title.toLowerCase()} to ease into your routine.`});ngOnInit(){this.store.loadRoutine()}reload(){this.store.loadRoutine()}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=w({type:i,selectors:[["app-routine-page"]],decls:6,vars:1,consts:[[1,"screen","screen--dark","sleep-summary-theme"],[1,"screen__section"],["title","No routine yet","message","Create a calming routine to wind down.","actionLabel","Create Routine"],["title","Syncing routine","message","Updating your routine steps.","actionLabel","View Device"],["title","Routine unavailable","actionLabel","Retry",3,"message"],[3,"height"],["title","No routine yet","message","Create a calming routine to wind down.","actionLabel","Create Routine",3,"action"],["title","Syncing routine","message","Updating your routine steps.","actionLabel","View Device",3,"action"],["title","Routine unavailable","actionLabel","Retry",3,"action","message"],[1,"screen__header"],[1,"screen__sub"],[1,"screen__title"],["routerLink","/alarm/settings",1,"primary-link"],[1,"list-row"],[1,"chart-card"],[1,"chart-card__summary"],["routerLink","/routine/edit",1,"chip"],[1,"screen__cta"],["routerLink","/routine/edit",1,"primary-link"],[1,"list-row__meta"]],template:function(t,r){if(t&1&&(n(0,"section",0),b(1,z,3,2,"div",1)(2,G,1,0,"app-state-panel",2)(3,H,1,0,"app-state-panel",3)(4,J,1,1,"app-state-panel",4)(5,Q,23,3),o()),t&2){let a;s(),R((a=r.viewState())==="loading"?1:a==="no-data"?2:a==="syncing"?3:a==="error"?4:5)}},dependencies:[V,P,k,D],encapsulation:2})}return i})();function X(i,p){i&1&&(n(0,"div",1),I(1,"ui-skeleton",3)(2,"ui-skeleton",3),o()),i&2&&(s(),d("height",24),s(),d("height",140))}function Y(i,p){if(i&1){let e=x();n(0,"app-state-panel",4),_("action",function(){m(e);let r=u();return c(r.reload())}),o()}if(i&2){let e=u();d("message",e.store.errorMessage()??"Could not load routine editor.")}}function Z(i,p){if(i&1){let e=x();n(0,"div",16)(1,"label",20)(2,"span",11),l(3,"Step title"),o(),n(4,"input",21),_("input",function(r){let a=m(e).$index,S=u(2);return c(S.onStepTitleInput(a,r))}),o()(),n(5,"label",22)(6,"span",11),l(7,"Minutes"),o(),n(8,"input",23),_("input",function(r){let a=m(e).$index,S=u(2);return c(S.onStepDurationInput(a,r))}),o()(),n(9,"label",24)(10,"span",11),l(11,"Emoji"),o(),n(12,"input",25),_("input",function(r){let a=m(e).$index,S=u(2);return c(S.onStepEmojiInput(a,r))}),o()(),n(13,"button",26),_("click",function(){let r=m(e).$index,a=u(2);return c(a.removeStep(r))}),l(14," Remove "),o()()}if(i&2){let e=p.$implicit,t=u(2);s(4),d("value",e.title),s(4),d("value",e.durationMinutes),s(4),d("value",e.emoji),s(),d("disabled",t.editableSteps().length<=1)}}function ee(i,p){if(i&1&&(n(0,"p",17),l(1),o()),i&2){let e=u(2);s(),h(e.validationMessage())}}function te(i,p){if(i&1){let e=x();n(0,"div",5)(1,"div")(2,"p",6),l(3,"Edit Routine"),o(),n(4,"h1",7),l(5),o()(),n(6,"a",8),l(7,"Back"),o()(),n(8,"form",9),_("submit",function(r){m(e);let a=u();return c(a.onSubmit(r))}),n(9,"label",10)(10,"span",11),l(11,"Routine title"),o(),n(12,"input",12),_("input",function(r){m(e);let a=u();return c(a.onTitleInput(r))}),o()(),n(13,"div",13)(14,"div",14)(15,"h3"),l(16,"Steps"),o(),n(17,"button",15),_("click",function(){m(e);let r=u();return c(r.addStep())}),l(18," Add step "),o()(),M(19,Z,15,4,"div",16,U),o(),b(21,ee,2,1,"p",17),n(22,"div",18)(23,"ui-button",19),l(24),o(),n(25,"a",8),l(26,"Cancel"),o()()()}if(i&2){let e=u();s(5),h(e.routineTitle()),s(7),d("value",e.titleInput()),s(7),T(e.editableSteps()),s(2),R(e.validationMessage()?21:-1),s(2),d("disabled",!e.canSubmit()||e.store.isSaving()),s(),E(" ",e.store.isSaving()?"Saving...":"Save routine"," ")}}var O=(()=>{class i{store=v(N);viewState=this.store.status;titleInput=g("");editableSteps=g([]);routineTitle=f(()=>this.store.routine()?.title??"Edit routine");validationMessage=f(()=>{if(!this.titleInput().trim())return"Routine title is required.";if(this.editableSteps().length===0)return"Add at least one routine step.";for(let e of this.editableSteps()){if(!e.title.trim())return"Each step needs a title.";if(Number.isNaN(e.durationMinutes)||e.durationMinutes<1||e.durationMinutes>60)return"Step duration must be between 1 and 60 minutes."}return null});canSubmit=f(()=>this.validationMessage()===null);ngOnInit(){this.store.loadRoutine().then(()=>this.hydrateFromStore())}reload(){this.store.loadRoutine().then(()=>this.hydrateFromStore())}onTitleInput(e){let t=e.target;this.titleInput.set(t.value)}onStepTitleInput(e,t){let r=t.target;this.updateStep(e,{title:r.value})}onStepDurationInput(e,t){let r=t.target,a=Number(r.value);this.updateStep(e,{durationMinutes:Number.isNaN(a)?0:a})}onStepEmojiInput(e,t){let r=t.target;this.updateStep(e,{emoji:r.value.trim()})}addStep(){this.editableSteps.update(e=>[...e,{title:"",durationMinutes:5,emoji:""}])}removeStep(e){this.editableSteps.update(t=>t.filter((r,a)=>a!==e))}onSubmit(e){return C(this,null,function*(){e.preventDefault(),this.canSubmit()&&(yield this.store.updateRoutine({title:this.titleInput().trim(),steps:this.editableSteps().map(t=>({id:t.id,title:t.title.trim(),durationMinutes:t.durationMinutes,emoji:t.emoji||null}))}),this.store.status()==="success"&&this.hydrateFromStore())})}hydrateFromStore(){let e=this.store.routine();e&&(this.titleInput.set(e.title),this.editableSteps.set(e.steps.map(t=>({id:t.id,title:t.title,durationMinutes:t.duration_minutes,emoji:t.emoji??""}))))}updateStep(e,t){this.editableSteps.update(r=>r.map((a,S)=>S===e?j(j({},a),t):a))}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=w({type:i,selectors:[["app-routine-edit-page"]],decls:4,vars:1,consts:[[1,"screen","screen--dark","sleep-summary-theme"],[1,"screen__section"],["title","Routine editor unavailable","actionLabel","Retry",3,"message"],[3,"height"],["title","Routine editor unavailable","actionLabel","Retry",3,"action","message"],[1,"screen__header"],[1,"screen__sub"],[1,"screen__title"],["routerLink","/routine",1,"primary-link"],[1,"screen__section",3,"submit"],[1,"form-field"],[1,"form-field__label"],["type","text","maxlength","80","required","",1,"form-field__input",3,"input","value"],[1,"chart-card"],[1,"section-header"],["type","button",1,"chip",3,"click"],[1,"routine-step-edit"],["role","alert",1,"form-error"],[1,"screen__cta"],[3,"disabled"],[1,"form-field","routine-step-edit__title"],["type","text","maxlength","60","required","",1,"form-field__input",3,"input","value"],[1,"form-field","routine-step-edit__duration"],["type","number","min","1","max","60","required","",1,"form-field__input",3,"input","value"],[1,"form-field","routine-step-edit__emoji"],["type","text","maxlength","3",1,"form-field__input",3,"input","value"],["type","button",1,"chip","chip--danger",3,"click","disabled"]],template:function(t,r){if(t&1&&(n(0,"section",0),b(1,X,3,2,"div",1)(2,Y,1,1,"app-state-panel",2)(3,te,27,5),o()),t&2){let a;s(),R((a=r.viewState())==="loading"?1:a==="error"?2:3)}},dependencies:[V,P,D,k],encapsulation:2})}return i})();var ke=[{path:"",component:q},{path:"edit",component:O}];export{ke as ROUTINE_ROUTES};
