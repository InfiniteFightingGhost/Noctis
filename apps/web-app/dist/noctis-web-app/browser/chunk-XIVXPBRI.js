import{a as I}from"./chunk-RGYE5VVO.js";import{a as T,b as $}from"./chunk-IDKFOCDJ.js";import{a as N,b as k}from"./chunk-OLQLXGD7.js";import{f as P}from"./chunk-R6BJDFJL.js";import{Cb as w,Fa as L,Ga as C,I as b,Ka as u,La as t,M as d,Ma as n,Na as p,R as f,Ra as S,S as _,Ta as x,Va as g,ba as c,c as R,db as a,eb as m,fb as y,gb as D,lb as s,o as E,oa as o,ya as M}from"./chunk-VHPO65OP.js";var F=(()=>{class i{api=d(w);getLatestReport(){return this.api.get("/v1/report/latest")}static \u0275fac=function(r){return new(r||i)};static \u0275prov=b({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var B=i=>i==="missing"?"no-data":i==="syncing"?"syncing":i==="error"?"error":"success",j=(()=>{class i{api=d(F);cachedReport=c(null);report=c(null);status=c("loading");errorMessage=c(null);isFetching=c(!1);isPartial=s(()=>this.report()?.dataQuality.status==="partial");loadLatest(){return R(this,null,function*(){this.status.set("loading"),this.errorMessage.set(null),this.isFetching.set(!0);try{let e=yield E(this.api.getLatestReport());this.report.set(e);let r=B(e.dataQuality.status);this.status.set(r),r==="success"&&this.cachedReport.set(e)}catch(e){let r=N(e);this.errorMessage.set(r.message),this.status.set("error"),this.cachedReport()&&this.report.set(this.cachedReport())}finally{this.isFetching.set(!1)}})}static \u0275fac=function(r){return new(r||i)};static \u0275prov=b({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function O(i,v){i&1&&(t(0,"div",1),p(1,"ui-skeleton",5)(2,"ui-skeleton",5)(3,"ui-skeleton",5)(4,"ui-skeleton",5),n()),i&2&&(o(),u("height",20),o(),u("height",100),o(),u("height",140),o(),u("height",140))}function H(i,v){if(i&1){let e=S();t(0,"app-state-panel",6),x("action",function(){f(e);let l=g();return _(l.reload())}),n()}}function Q(i,v){if(i&1){let e=S();t(0,"app-state-panel",7),x("action",function(){f(e);let l=g();return _(l.reload())}),n()}}function U(i,v){if(i&1){let e=S();t(0,"app-state-panel",8),x("action",function(){f(e);let l=g();return _(l.reload())}),n()}if(i&2){let e=g();u("message",e.store.errorMessage()??"We could not load this report.")}}function W(i,v){i&1&&p(0,"ui-status-banner",13)}function z(i,v){if(i&1&&(t(0,"div",9)(1,"div")(2,"p",10),a(3,"Night Report"),n(),t(4,"h1",11),a(5),n(),t(6,"p",10),a(7),n()(),t(8,"a",12),a(9,"Back"),n()(),t(10,"div",1),L(11,W,1,0,"ui-status-banner",13),t(12,"div",14)(13,"div",15)(14,"div",16),a(15,"Score"),n(),t(16,"div",17),a(17),n()(),t(18,"div",15)(19,"div",16),a(20,"TST"),n(),t(21,"div",17),a(22),n()(),t(23,"div",15)(24,"div",16),a(25,"Efficiency"),n(),t(26,"div",17),a(27),n()(),t(28,"div",15)(29,"div",16),a(30,"Deep"),n(),t(31,"div",17),a(32),n()()(),t(33,"details",18)(34,"summary",19)(35,"h3"),a(36,"Overview"),n(),t(37,"span",10),a(38,"Stages + notes"),n()(),t(39,"div",1)(40,"div",20),p(41,"div",21),t(42,"p",22),a(43),n()(),t(44,"p",22),a(45),n()()(),t(46,"details",23)(47,"summary",19)(48,"h3"),a(49,"Trends"),n(),t(50,"span",10),a(51,"Last 7 nights"),n()(),t(52,"div",1)(53,"div",20),p(54,"div",21),t(55,"p",22),a(56),n()()()(),t(57,"details",23)(58,"summary",19)(59,"h3"),a(60,"Movement"),n(),t(61,"span",10),a(62,"Peaks labeled"),n()(),t(63,"div",1)(64,"div",20),p(65,"div",21),t(66,"p",22),a(67),n()()()(),t(68,"details",23)(69,"summary",19)(70,"h3"),a(71,"Physiology"),n(),t(72,"span",10),a(73,"HR + RR"),n()(),t(74,"div",1)(75,"div",20),p(76,"div",21),t(77,"p",22),a(78),n()()()(),t(79,"div",24)(80,"ui-button"),a(81,"Share Report"),n(),t(82,"a",25),a(83," Coach me on this night "),n()()()),i&2){let e=g();o(5),m(e.dateLabel()),o(2),m(e.timeRangeLabel()),o(4),C(e.isPartial()?11:-1),o(6),m(e.scoreLabel()),o(5),m(e.totalSleepLabel()),o(5),m(e.efficiencyLabel()),o(5),m(e.deepLabel()),o(11),y(" ",e.stageSummaryLabel()," "),o(2),y(" ",e.insightLabel()," "),o(11),m(e.trendLabel()),o(11),y(" Movement ",e.movementLabel()," "),o(11),D(" Avg HR ",e.hrLabel(),", Avg RR ",e.rrLabel(),". ")}}var A=(()=>{class i{store=d(j);report=this.store.report;viewState=this.store.status;isPartial=this.store.isPartial;dateLabel=s(()=>this.report()?.dateLocal??"Tue, Feb 18");timeRangeLabel=s(()=>{let e=this.report();return e?`${e.bedtimeLocal} \u2013 ${e.waketimeLocal}`:"10:38pm \u2013 6:41am"});scoreLabel=s(()=>{let e=this.report()?.score;return e!==void 0?String(e):"\u2014"});totalSleepLabel=s(()=>{let e=this.report()?.totals.totalSleepMin;return this.formatMinutes(e)});efficiencyLabel=s(()=>{let e=this.report()?.totals.sleepEfficiencyPct;return e!==void 0?`${Math.round(e)}%`:"\u2014"});deepLabel=s(()=>{let e=this.report()?.metrics.deepPct;return e!==void 0?`${Math.round(e)}%`:"\u2014"});stageSummaryLabel=s(()=>{let e=this.report()?.stages.pct;return e?`Awake ${e.awake}%, Light ${e.light}%, Deep ${e.deep}%, REM ${e.rem}%`:"Stage distribution unavailable"});insightLabel=s(()=>this.report()?.insight.text??"No summary insight available.");trendLabel=s(()=>`Sleep score ${this.scoreLabel()} with deep sleep ${this.deepLabel()}.`);movementLabel=s(()=>{let e=this.report()?.metrics.movementPct;return e==null?"unavailable":`${e}% of time in bed`});hrLabel=s(()=>{let e=this.report()?.metrics.avgHrBpm;return e!==void 0?`${e} bpm`:"\u2014"});rrLabel=s(()=>{let e=this.report()?.metrics.avgRrBrpm;return e!==void 0?`${e} brpm`:"\u2014"});ngOnInit(){this.store.loadLatest()}reload(){this.store.loadLatest()}formatMinutes(e){if(e==null)return"\u2014";let r=Math.floor(e/60),l=Math.round(e%60);return r<=0?`${l}m`:`${r}h ${l}m`}static \u0275fac=function(r){return new(r||i)};static \u0275cmp=M({type:i,selectors:[["app-report-page"]],decls:6,vars:1,consts:[[1,"screen","screen--dark","sleep-summary-theme"],[1,"screen__section"],["title","No report yet","message","Sync your device to generate a nightly report.","actionLabel","Check Device"],["title","Syncing data","message","We're updating your nightly report.","actionLabel","View Device"],["title","Report unavailable","actionLabel","Retry",3,"message"],[3,"height"],["title","No report yet","message","Sync your device to generate a nightly report.","actionLabel","Check Device",3,"action"],["title","Syncing data","message","We're updating your nightly report.","actionLabel","View Device",3,"action"],["title","Report unavailable","actionLabel","Retry",3,"action","message"],[1,"screen__header"],[1,"screen__sub"],[1,"screen__title"],["routerLink","/dashboard",1,"primary-link"],["variant","partial","title","Partial data","message","Some sensors dropped; accuracy reduced.","actionLabel","Details"],["aria-label","Summary strip",1,"summary-strip"],[1,"summary-strip__item"],[1,"summary-strip__label"],[1,"summary-strip__value"],["open","",1,"chart-card"],[1,"section-header"],["aria-hidden","true",1,"chart-card"],[1,"stage-viz__bar"],[1,"chart-card__summary"],[1,"chart-card"],[1,"screen__cta"],["routerLink","/coach",1,"primary-link"]],template:function(r,l){if(r&1&&(t(0,"section",0),L(1,O,5,4,"div",1)(2,H,1,0,"app-state-panel",2)(3,Q,1,0,"app-state-panel",3)(4,U,1,1,"app-state-panel",4)(5,z,84,13),n()),r&2){let h;o(),C((h=l.viewState())==="loading"?1:h==="no-data"?2:h==="syncing"?3:h==="error"?4:5)}},dependencies:[P,k,T,I,$],encapsulation:2})}return i})();var ge=[{path:"",component:A}];export{ge as REPORT_ROUTES};
